"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports["default"] = void 0;

var _classCallCheck2 = _interopRequireDefault(require("@babel/runtime/helpers/classCallCheck"));

var _createClass2 = _interopRequireDefault(require("@babel/runtime/helpers/createClass"));

var _possibleConstructorReturn2 = _interopRequireDefault(require("@babel/runtime/helpers/possibleConstructorReturn"));

var _getPrototypeOf3 = _interopRequireDefault(require("@babel/runtime/helpers/getPrototypeOf"));

var _assertThisInitialized2 = _interopRequireDefault(require("@babel/runtime/helpers/assertThisInitialized"));

var _inherits2 = _interopRequireDefault(require("@babel/runtime/helpers/inherits"));

var _defineProperty2 = _interopRequireDefault(require("@babel/runtime/helpers/defineProperty"));

var _react = _interopRequireDefault(require("react"));

var _glamor = require("glamor");

var _propTypes = _interopRequireDefault(require("prop-types"));

var _Transition = _interopRequireDefault(require("react-transition-group/Transition"));

var _Alert = _interopRequireDefault(require("../../alert/src/Alert"));

var animationEasing = {
  deceleration: "cubic-bezier(0.0, 0.0, 0.2, 1)",
  acceleration: "cubic-bezier(0.4, 0.0, 1, 1)",
  spring: "cubic-bezier(0.175, 0.885, 0.320, 1.175)"
};
var ANIMATION_DURATION = 240;

var openAnimation = _glamor.css.keyframes('openAnimation', {
  from: {
    opacity: 0,
    transform: 'translateY(-120%)'
  },
  to: {
    transform: 'translateY(0)'
  }
});

var closeAnimation = _glamor.css.keyframes('closeAnimation', {
  from: {
    transform: 'scale(1)',
    opacity: 1
  },
  to: {
    transform: 'scale(0.9)',
    opacity: 0
  }
});

var animationStyles = (0, _glamor.css)({
  display: 'flex',
  flexDirection: 'column',
  alignItems: 'center',
  height: 0,
  transition: "all ".concat(ANIMATION_DURATION, "ms ").concat(animationEasing.deceleration),
  '&[data-state="entering"], &[data-state="entered"]': {
    animation: "".concat(openAnimation, " ").concat(ANIMATION_DURATION, "ms ").concat(animationEasing.spring, " both")
  },
  '&[data-state="exiting"]': {
    animation: "".concat(closeAnimation, " 120ms ").concat(animationEasing.acceleration, " both")
  }
});

var Toast =
/*#__PURE__*/
function (_React$PureComponent) {
  (0, _inherits2["default"])(Toast, _React$PureComponent);

  function Toast() {
    var _getPrototypeOf2;

    var _this;

    (0, _classCallCheck2["default"])(this, Toast);

    for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {
      args[_key] = arguments[_key];
    }

    _this = (0, _possibleConstructorReturn2["default"])(this, (_getPrototypeOf2 = (0, _getPrototypeOf3["default"])(Toast)).call.apply(_getPrototypeOf2, [this].concat(args)));
    (0, _defineProperty2["default"])((0, _assertThisInitialized2["default"])(_this), "state", {
      isShown: true,
      height: 0
    });
    (0, _defineProperty2["default"])((0, _assertThisInitialized2["default"])(_this), "close", function () {
      _this.clearCloseTimer();

      _this.setState({
        isShown: false
      });
    });
    (0, _defineProperty2["default"])((0, _assertThisInitialized2["default"])(_this), "startCloseTimer", function () {
      if (_this.props.duration) {
        _this.closeTimer = setTimeout(function () {
          _this.close();
        }, _this.props.duration * 1000);
      }
    });
    (0, _defineProperty2["default"])((0, _assertThisInitialized2["default"])(_this), "clearCloseTimer", function () {
      if (_this.closeTimer) {
        clearTimeout(_this.closeTimer);
        _this.closeTimer = null;
      }
    });
    (0, _defineProperty2["default"])((0, _assertThisInitialized2["default"])(_this), "handleMouseEnter", function () {
      _this.clearCloseTimer();
    });
    (0, _defineProperty2["default"])((0, _assertThisInitialized2["default"])(_this), "handleMouseLeave", function () {
      _this.startCloseTimer();
    });
    (0, _defineProperty2["default"])((0, _assertThisInitialized2["default"])(_this), "onRef", function (ref) {
      if (ref === null) return;

      var _ref$getBoundingClien = ref.getBoundingClientRect(),
          height = _ref$getBoundingClien.height;

      _this.setState({
        height: height
      });
    });
    return _this;
  }

  (0, _createClass2["default"])(Toast, [{
    key: "componentDidUpdate",
    value: function componentDidUpdate(prevProps) {
      if (prevProps.isShown !== this.props.isShown) {
        // eslint-disable-next-line react/no-did-update-set-state
        this.setState({
          isShown: this.props.isShown
        });
      }
    }
  }, {
    key: "componentDidMount",
    value: function componentDidMount() {
      this.startCloseTimer();
    }
  }, {
    key: "componentWillUnmount",
    value: function componentWillUnmount() {
      this.clearCloseTimer();
    }
  }, {
    key: "render",
    value: function render() {
      var _this2 = this;

      return _react["default"].createElement(_Transition["default"], {
        appear: true,
        unmountOnExit: true,
        timeout: ANIMATION_DURATION,
        "in": this.state.isShown,
        onExited: this.props.onRemove
      }, function (state) {
        return _react["default"].createElement("div", {
          "data-state": state,
          className: animationStyles,
          onMouseEnter: _this2.handleMouseEnter,
          onMouseLeave: _this2.handleMouseLeave,
          style: {
            height: _this2.state.height,
            zIndex: _this2.props.zIndex,
            marginBottom: _this2.state.isShown ? 0 : -_this2.state.height
          }
        }, _react["default"].createElement("div", {
          ref: _this2.onRef,
          style: {
            padding: 8
          }
        }, _react["default"].createElement(_Alert["default"], {
          flexShrink: 0,
          appearance: "card",
          elevation: 3,
          intent: _this2.props.intent,
          title: _this2.props.title,
          isRemoveable: _this2.props.hasCloseButton,
          onRemove: function onRemove() {
            return _this2.close();
          },
          pointerEvents: "all"
        }, _this2.props.children)));
      });
    }
  }]);
  return Toast;
}(_react["default"].PureComponent);

exports["default"] = Toast;
Toast.displayName = "Toast";
(0, _defineProperty2["default"])(Toast, "propTypes", {
  /**
   * The z-index of the toast.
   */
  zIndex: _propTypes["default"].number,

  /**
   * Duration of the toast.
   */
  duration: _propTypes["default"].number,

  /**
   * Function called when the toast is all the way closed.
   */
  onRemove: _propTypes["default"].func,

  /**
   * The type of the alert.
   */
  intent: _propTypes["default"].oneOf(['none', 'success', 'warning', 'danger']).isRequired,

  /**
   * The title of the alert.
   */
  title: _propTypes["default"].node,

  /**
   * Description of the alert.
   */
  children: _propTypes["default"].node,

  /**
   * When true, show a close icon button inside of the toast.
   */
  hasCloseButton: _propTypes["default"].bool,

  /**
   * When false, will close the Toast and call onRemove when finished.
   */
  isShown: _propTypes["default"].bool
});
(0, _defineProperty2["default"])(Toast, "defaultProps", {
  intent: 'none'
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy90b2FzdGVyL3NyYy9Ub2FzdC5qcyJdLCJuYW1lcyI6WyJhbmltYXRpb25FYXNpbmciLCJkZWNlbGVyYXRpb24iLCJhY2NlbGVyYXRpb24iLCJzcHJpbmciLCJBTklNQVRJT05fRFVSQVRJT04iLCJvcGVuQW5pbWF0aW9uIiwiY3NzIiwia2V5ZnJhbWVzIiwiZnJvbSIsIm9wYWNpdHkiLCJ0cmFuc2Zvcm0iLCJ0byIsImNsb3NlQW5pbWF0aW9uIiwiYW5pbWF0aW9uU3R5bGVzIiwiZGlzcGxheSIsImZsZXhEaXJlY3Rpb24iLCJhbGlnbkl0ZW1zIiwiaGVpZ2h0IiwidHJhbnNpdGlvbiIsImFuaW1hdGlvbiIsIlRvYXN0IiwiaXNTaG93biIsImNsZWFyQ2xvc2VUaW1lciIsInNldFN0YXRlIiwicHJvcHMiLCJkdXJhdGlvbiIsImNsb3NlVGltZXIiLCJzZXRUaW1lb3V0IiwiY2xvc2UiLCJjbGVhclRpbWVvdXQiLCJzdGFydENsb3NlVGltZXIiLCJyZWYiLCJnZXRCb3VuZGluZ0NsaWVudFJlY3QiLCJwcmV2UHJvcHMiLCJzdGF0ZSIsIm9uUmVtb3ZlIiwiaGFuZGxlTW91c2VFbnRlciIsImhhbmRsZU1vdXNlTGVhdmUiLCJ6SW5kZXgiLCJtYXJnaW5Cb3R0b20iLCJvblJlZiIsInBhZGRpbmciLCJpbnRlbnQiLCJ0aXRsZSIsImhhc0Nsb3NlQnV0dG9uIiwiY2hpbGRyZW4iLCJSZWFjdCIsIlB1cmVDb21wb25lbnQiLCJQcm9wVHlwZXMiLCJudW1iZXIiLCJmdW5jIiwib25lT2YiLCJpc1JlcXVpcmVkIiwibm9kZSIsImJvb2wiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBQUE7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBRUEsSUFBTUEsZUFBZSxHQUFHO0FBQ3RCQyxFQUFBQSxZQUFZLGtDQURVO0FBRXRCQyxFQUFBQSxZQUFZLGdDQUZVO0FBR3RCQyxFQUFBQSxNQUFNO0FBSGdCLENBQXhCO0FBTUEs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QUFBLFFBQVEsRUFBRTtBQUFBLG1CQUFNLE1BQUksQ0FBQ2hCLEtBQUwsRUFBTjtBQUFBLFdBUFo7QUFRRSxVQUFBLGFBQWEsRUFBQztBQVJoQixXQVVHLE1BQUksQ0FBQ0osS0FBTCxDQUFXcUIsUUFWZCxDQURGLENBWEYsQ0FESTtBQUFBLE9BUFIsQ0FERjtBQXNDRDs7O0VBckpnQ0Msa0JBQU1DLGE7OztBQUFwQjNCLEs7aUNBQUFBLEssZUFDQTtBQUNqQjs7O0FBR0FrQixFQUFBQSxNQUFNLEVBQUVVLHNCQUFVQyxNQUpEOztBQU1qQjs7O0FBR0F4QixFQUFBQSxRQUFRLEVBQUV1QixzQkFBVUMsTUFUSDs7QUFXakI7OztBQUdBZCxFQUFBQSxRQUFRLEVBQUVhLHNCQUFVRSxJQWRIOztBQWdCakI7OztBQUdBUixFQUFBQSxNQUFNLEVBQUVNLHNCQUFVRyxLQUFWLENBQWdCLENBQUMsTUFBRCxFQUFTLFNBQVQsRUFBb0IsU0FBcEIsRUFBK0IsUUFBL0IsQ0FBaEIsRUFDTEMsVUFwQmM7O0FBc0JqQjs7O0FBR0FULEVBQUFBLEtBQUssRUFBRUssc0JBQVVLLElBekJBOztBQTJCakI7OztBQUdBUixFQUFBQSxRQUFRLEVBQUVHLHNCQUFVSyxJQTlCSDs7QUFnQ2pCOzs7QUFHQVQsRUFBQUEsY0FBYyxFQUFFSSxzQkFBVU0sSUFuQ1Q7O0FBcUNqQjs7O0FBR0FqQyxFQUFBQSxPQUFPLEVBQUUyQixzQkFBVU07QUF4Q0YsQztpQ0FEQWxDLEssa0JBNENHO0FBQ3BCc0IsRUFBQUEsTUFBTSxFQUFFO0FBRFksQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBSZWFjdCBmcm9tICdyZWFjdCdcbmltcG9ydCB7IGNzcyB9IGZyb20gJ2dsYW1vcidcbmltcG9ydCBQcm9wVHlwZXMgZnJvbSAncHJvcC10eXBlcydcbmltcG9ydCBUcmFuc2l0aW9uIGZyb20gJ3JlYWN0LXRyYW5zaXRpb24tZ3JvdXAvVHJhbnNpdGlvbidcbmltcG9ydCBBbGVydCBmcm9tICcuLi8uLi9hbGVydC9zcmMvQWxlcnQnXG5cbmNvbnN0IGFuaW1hdGlvbkVhc2luZyA9IHtcbiAgZGVjZWxlcmF0aW9uOiBgY3ViaWMtYmV6aWVyKDAuMCwgMC4wLCAwLjIsIDEpYCxcbiAgYWNjZWxlcmF0aW9uOiBgY3ViaWMtYmV6aWVyKDAuNCwgMC4wLCAxLCAxKWAsXG4gIHNwcmluZzogYGN1YmljLWJlemllcigwLjE3NSwgMC44ODUsIDAuMzIwLCAxLjE3NSlgXG59XG5cbmNvbnN0IEFOSU1BVElPTl9EVVJBVElPTiA9IDI0MFxuXG5jb25zdCBvcGVuQW5pbWF0aW9uID0gY3NzLmtleWZyYW1lcygnb3BlbkFuaW1hdGlvbicsIHtcbiAgZnJvbToge1xuICAgIG9wYWNpdHk6IDAsXG4gICAgdHJhbnNmb3JtOiAndHJhbnNsYXRlWSgtMTIwJSknXG4gIH0sXG4gIHRvOiB7XG4gICAgdHJhbnNmb3JtOiAndHJhbnNsYXRlWSgwKSdcbiAgfVxufSlcblxuY29uc3QgY2xvc2VBbmltYXRpb24gPSBjc3Mua2V5ZnJhbWVzKCdjbG9zZUFuaW1hdGlvbicsIHtcbiAgZnJvbToge1xuICAgIHRyYW5zZm9ybTogJ3NjYWxlKDEpJyxcbiAgICBvcGFjaXR5OiAxXG4gIH0sXG4gIHRvOiB7XG4gICAgdHJhbnNmb3JtOiAnc2NhbGUoMC45KScsXG4gICAgb3BhY2l0eTogMFxuICB9XG59KVxuXG5jb25zdCBhbmltYXRpb25TdHlsZXMgPSBjc3Moe1xuICBkaXNwbGF5OiAnZmxleCcsXG4gIGZsZXhEaXJlY3Rpb246ICdjb2x1bW4nLFxuICBhbGlnbkl0ZW1zOiAnY2VudGVyJyxcbiAgaGVpZ2h0OiAwLFxuICB0cmFuc2l0aW9uOiBgYWxsICR7QU5JTUFUSU9OX0RVUkFUSU9OfW1zICR7YW5pbWF0aW9uRWFzaW5nLmRlY2VsZXJhdGlvbn1gLFxuICAnJltkYXRhLXN0YXRlPVwiZW50ZXJpbmdcIl0sICZbZGF0YS1zdGF0ZT1cImVudGVyZWRcIl0nOiB7XG4gICAgYW5pbWF0aW9uOiBgJHtvcGVuQW5pbWF0aW9ufSAke0FOSU1BVElPTl9EVVJBVElPTn1tcyAke1xuICAgICAgYW5pbWF0aW9uRWFzaW5nLnNwcmluZ1xuICAgIH0gYm90aGBcbiAgfSxcbiAgJyZbZGF0YS1zdGF0ZT1cImV4aXRpbmdcIl0nOiB7XG4gICAgYW5pbWF0aW9uOiBgJHtjbG9zZUFuaW1hdGlvbn0gMTIwbXMgJHthbmltYXRpb25FYXNpbmcuYWNjZWxlcmF0aW9ufSBib3RoYFxuICB9XG59KVxuXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBUb2FzdCBleHRlbmRzIFJlYWN0LlB1cmVDb21wb25lbnQge1xuICBzdGF0aWMgcHJvcFR5cGVzID0ge1xuICAgIC8qKlxuICAgICAqIFRoZSB6LWluZGV4IG9mIHRoZSB0b2FzdC5cbiAgICAgKi9cbiAgICB6SW5kZXg6IFByb3BUeXBlcy5udW1iZXIsXG5cbiAgICAvKipcbiAgICAgKiBEdXJhdGlvbiBvZiB0aGUgdG9hc3QuXG4gICAgICovXG4gICAgZHVyYXRpb246IFByb3BUeXBlcy5udW1iZXIsXG5cbiAgICAvKipcbiAgICAgKiBGdW5jdGlvbiBjYWxsZWQgd2hlbiB0aGUgdG9hc3QgaXMgYWxsIHRoZSB3YXkgY2xvc2VkLlxuICAgICAqL1xuICAgIG9uUmVtb3ZlOiBQcm9wVHlwZXMuZnVuYyxcblxuICAgIC8qKlxuICAgICAqIFRoZSB0eXBlIG9mIHRoZSBhbGVydC5cbiAgICAgKi9cbiAgICBpbnRlbnQ6IFByb3BUeXBlcy5vbmVPZihbJ25vbmUnLCAnc3VjY2VzcycsICd3YXJuaW5nJywgJ2RhbmdlciddKVxuICAgICAgLmlzUmVxdWlyZWQsXG5cbiAgICAvKipcbiAgICAgKiBUaGUgdGl0bGUgb2YgdGhlIGFsZXJ0LlxuICAgICAqL1xuICAgIHRpdGxlOiBQcm9wVHlwZXMubm9kZSxcblxuICAgIC8qKlxuICAgICAqIERlc2NyaXB0aW9uIG9mIHRoZSBhbGVydC5cbiAgICAgKi9cbiAgICBjaGlsZHJlbjogUHJvcFR5cGVzLm5vZGUsXG5cbiAgICAvKipcbiAgICAgKiBXaGVuIHRydWUsIHNob3cgYSBjbG9zZSBpY29uIGJ1dHRvbiBpbnNpZGUgb2YgdGhlIHRvYXN0LlxuICAgICAqL1xuICAgIGhhc0Nsb3NlQnV0dG9uOiBQcm9wVHlwZXMuYm9vbCxcblxuICAgIC8qKlxuICAgICAqIFdoZW4gZmFsc2UsIHdpbGwgY2xvc2UgdGhlIFRvYXN0IGFuZCBjYWxsIG9uUmVtb3ZlIHdoZW4gZmluaXNoZWQuXG4gICAgICovXG4gICAgaXNTaG93bjogUHJvcFR5cGVzLmJvb2xcbiAgfVxuXG4gIHN0YXRpYyBkZWZhdWx0UHJvcHMgPSB7XG4gICAgaW50ZW50OiAnbm9uZSdcbiAgfVxuXG4gIHN0YXRlID0ge1xuICAgIGlzU2hvd246IHRydWUsXG4gICAgaGVpZ2h0OiAwXG4gIH1cblxuICBjb21wb25lbnREaWRVcGRhdGUocHJldlByb3BzKSB7XG4gICAgaWYgKHByZXZQcm9wcy5pc1Nob3duICE9PSB0aGlzLnByb3BzLmlzU2hvd24pIHtcbiAgICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSByZWFjdC9uby1kaWQtdXBkYXRlLXNldC1zdGF0ZVxuICAgICAgdGhpcy5zZXRTdGF0ZSh7XG4gICAgICAgIGlzU2hvd246IHRoaXMucHJvcHMuaXNTaG93blxuICAgICAgfSlcbiAgICB9XG4gIH1cblxuICBjb21wb25lbnREaWRNb3VudCgpIHtcbiAgICB0aGlzLnN0YXJ0Q2xvc2VUaW1lcigpXG4gIH1cblxuICBjb21wb25lbnRXaWxsVW5tb3VudCgpIHtcbiAgICB0aGlzLmNsZWFyQ2xvc2VUaW1lcigpXG4gIH1cblxuICBjbG9zZSA9ICgpID0+IHtcbiAgICB0aGlzLmNsZWFyQ2xvc2VUaW1lcigpXG4gICAgdGhpcy5zZXRTdGF0ZSh7XG4gICAgICBpc1Nob3duOiBmYWxzZVxuICAgIH0pXG4gIH1cblxuICBzdGFydENsb3NlVGltZXIgPSAoKSA9PiB7XG4gICAgaWYgKHRoaXMucHJvcHMuZHVyYXRpb24pIHtcbiAgICAgIHRoaXMuY2xvc2VUaW1lciA9IHNldFRpbWVvdXQoKCkgPT4ge1xuICAgICAgICB0aGlzLmNsb3NlKClcbiAgICAgIH0sIHRoaXMucHJvcHMuZHVyYXRpb24gKiAxMDAwKVxuICAgIH1cbiAgfVxuXG4gIGNsZWFyQ2xvc2VUaW1lciA9ICgpID0+IHtcbiAgICBpZiAodGhpcy5jbG9zZVRpbWVyKSB7XG4gICAgICBjbGVhclRpbWVvdXQodGhpcy5jbG9zZVRpbWVyKVxuICAgICAgdGhpcy5jbG9zZVRpbWVyID0gbnVsbFxuICAgIH1cbiAgfVxuXG4gIGhhbmRsZU1vdXNlRW50ZXIgPSAoKSA9PiB7XG4gICAgdGhpcy5jbGVhckNsb3NlVGltZXIoKVxuICB9XG5cbiAgaGFuZGxlTW91c2VMZWF2ZSA9ICgpID0+IHtcbiAgICB0aGlzLnN0YXJ0Q2xvc2VUaW1lcigpXG4gIH1cblxuICBvblJlZiA9IHJlZiA9PiB7XG4gICAgaWYgKHJlZiA9PT0gbnVsbCkgcmV0dXJuXG5cbiAgICBjb25zdCB7IGhlaWdodCB9ID0gcmVmLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpXG5cbiAgICB0aGlzLnNldFN0YXRlKHtcbiAgICAgIGhlaWdodFxuICAgIH0pXG4gIH1cblxuICByZW5kZXIoKSB7XG4gICAgcmV0dXJuIChcbiAgICAgIDxUcmFuc2l0aW9uXG4gICAgICAgIGFwcGVhclxuICAgICAgICB1bm1vdW50T25FeGl0XG4gICAgICAgIHRpbWVvdXQ9e0FOSU1BVElPTl9EVVJBVElPTn1cbiAgICAgICAgaW49e3RoaXMuc3RhdGUuaXNTaG93bn1cbiAgICAgICAgb25FeGl0ZWQ9e3RoaXMucHJvcHMub25SZW1vdmV9XG4gICAgICA+XG4gICAgICAgIHtzdGF0ZSA9PiAoXG4gICAgICAgICAgPGRpdlxuICAgICAgICAgICAgZGF0YS1zdGF0ZT17c3RhdGV9XG4gICAgICAgICAgICBjbGFzc05hbWU9e2FuaW1hdGlvblN0eWxlc31cbiAgICAgICAgICAgIG9uTW91c2VFbnRlcj17dGhpcy5oYW5kbGVNb3VzZUVudGVyfVxuICAgICAgICAgICAgb25Nb3VzZUxlYXZlPXt0aGlzLmhhbmRsZU1vdXNlTGVhdmV9XG4gICAgICAgICAgICBzdHlsZT17e1xuICAgICAgICAgICAgICBoZWlnaHQ6IHRoaXMuc3RhdGUuaGVpZ2h0LFxuICAgICAgICAgICAgICB6SW5kZXg6IHRoaXMucHJvcHMuekluZGV4LFxuICAgICAgICAgICAgICBtYXJnaW5Cb3R0b206IHRoaXMuc3RhdGUuaXNTaG93biA/IDAgOiAtdGhpcy5zdGF0ZS5oZWlnaHRcbiAgICAgICAgICAgIH19XG4gICAgICAgICAgPlxuICAgICAgICAgICAgPGRpdiByZWY9e3RoaXMub25SZWZ9IHN0eWxlPXt7IHBhZGRpbmc6IDggfX0+XG4gICAgICAgICAgICAgIDxBbGVydFxuICAgICAgICAgICAgICAgIGZsZXhTaHJpbms9ezB9XG4gICAgICAgICAgICAgICAgYXBwZWFyYW5jZT1cImNhcmRcIlxuICAgICAgICAgICAgICAgIGVsZXZhdGlvbj17M31cbiAgICAgICAgICAgICAgICBpbnRlbnQ9e3RoaXMucHJvcHMuaW50ZW50fVxuICAgICAgICAgICAgICAgIHRpdGxlPXt0aGlzLnByb3BzLnRpdGxlfVxuICAgICAgICAgICAgICAgIGlzUmVtb3ZlYWJsZT17dGhpcy5wcm9wcy5oYXNDbG9zZUJ1dHRvbn1cbiAgICAgICAgICAgICAgICBvblJlbW92ZT17KCkgPT4gdGhpcy5jbG9zZSgpfVxuICAgICAgICAgICAgICAgIHBvaW50ZXJFdmVudHM9XCJhbGxcIlxuICAgICAgICAgICAgICA+XG4gICAgICAgICAgICAgICAge3RoaXMucHJvcHMuY2hpbGRyZW59XG4gICAgICAgICAgICAgIDwvQWxlcnQ+XG4gICAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgKX1cbiAgICAgIDwvVHJhbnNpdGlvbj5cbiAgICApXG4gIH1cbn1cbiJdfQ==