"use strict";

var _interopRequireWildcard = require("@babel/runtime/helpers/interopRequireWildcard");

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports["default"] = void 0;

var _extends2 = _interopRequireDefault(require("@babel/runtime/helpers/extends"));

var _objectWithoutProperties2 = _interopRequireDefault(require("@babel/runtime/helpers/objectWithoutProperties"));

var _classCallCheck2 = _interopRequireDefault(require("@babel/runtime/helpers/classCallCheck"));

var _createClass2 = _interopRequireDefault(require("@babel/runtime/helpers/createClass"));

var _possibleConstructorReturn2 = _interopRequireDefault(require("@babel/runtime/helpers/possibleConstructorReturn"));

var _getPrototypeOf3 = _interopRequireDefault(require("@babel/runtime/helpers/getPrototypeOf"));

var _assertThisInitialized2 = _interopRequireDefault(require("@babel/runtime/helpers/assertThisInitialized"));

var _inherits2 = _interopRequireDefault(require("@babel/runtime/helpers/inherits"));

var _defineProperty2 = _interopRequireDefault(require("@babel/runtime/helpers/defineProperty"));

var _react = _interopRequireWildcard(require("react"));

var _propTypes = _interopRequireDefault(require("prop-types"));

var _classnames = _interopRequireDefault(require("classnames"));

var _toaster = require("../../toaster");

var _theme = require("../../theme");

var _layers = require("../../layers");

var _safeInvoke = _interopRequireDefault(require("../../lib/safe-invoke"));

var _TableRowContext = require("./TableRowContext");

var _manageTableCellFocusInteraction = _interopRequireDefault(require("./manageTableCellFocusInteraction"));

function ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }

function _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { (0, _defineProperty2["default"])(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }

function executeArrowKeyOverride(override) {
  if (!override) {
    return;
  }

  if (typeof override === 'function') {
    override();
    return;
  }

  if (typeof override === 'string') {
    document.querySelector(override).focus();
    return;
  } // This needs to be the node, not a React ref.


  override.focus();
}

var TableCell =
/*#__PURE__*/
function (_PureComponent) {
  (0, _inherits2["default"])(TableCell, _PureComponent);

  function TableCell() {
    var _getPrototypeOf2;

    var _this;

    (0, _classCallCheck2["default"])(this, TableCell);

    for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {
      args[_key] = arguments[_key];
    }

    _this = (0, _possibleConstructorReturn2["default"])(this, (_getPrototypeOf2 = (0, _getPrototypeOf3["default"])(TableCell)).call.apply(_getPrototypeOf2, [this].concat(args)));
    (0, _defineProperty2["default"])((0, _assertThisInitialized2["default"])(_this), "handleKeyDown", function (e) {
      var _this$props$arrowKeys = _this.props.arrowKeysOverrides,
          arrowKeysOverrides = _this$props$arrowKeys === void 0 ? {} : _this$props$arrowKeys;

      if (_this.props.isSelectable) {
        var key = e.key;

        if (key === 'ArrowUp' || key === 'ArrowDown' || key === 'ArrowLeft' || key === 'ArrowRight') {
          e.preventDefault();

          try {
            // Support arrow key overrides.
            var override = arrowKeysOverrides[key.slice('Arrow'.length).toLowerCase()];
            if (override === false) return;
            if (override) return executeArrowKeyOverride(override);
            (0, _manageTableCellFocusInteraction["default"])(key, _this.mainRef);
          } catch (error) {
            _toaster.toaster.danger('Keyboard interaction not possible');

            console.error('Keyboard interaction not possible', error);
          }
        } else if (key === 'Escape') {
          _this.mainRef.blur();
        }
      }

      (0, _safeInvoke["default"])(_this.props.onKeyDown, e);
    });
    (0, _defineProperty2["default"])((0, _assertThisInitialized2["default"])(_this), "onRef", function (ref) {
      _this.mainRef = ref;
      (0, _safeInvoke["default"])(_this.props.innerRef, ref);
    });
    return _this;
  }

  (0, _createClass2["default"])(TableCell, [{
    key: "render",
    value: function render() {
      var _this2 = this;

      var _this$props = this.props,
          innerRef = _this$props.innerRef,
          theme = _this$props.theme,
          children = _this$props.children,
          appearance = _this$props.appearance,
          onClick = _this$props.onClick,
          onKeyPress = _this$props.onKeyPress,
          onKeyDown = _this$props.onKeyDown,
          isSelectable = _this$props.isSelectable,
          _this$props$tabIndex = _this$props.tabIndex,
          tabIndex = _this$props$tabIndex === void 0 ? -1 : _this$props$tabIndex,
          className = _this$props.className,
          rightView = _this$props.rightView,
          arrowKeysOverrides = _this$props.arrowKeysOverrides,
          props = (0, _objectWithoutProperties2["default"])(_this$props, ["innerRef", "theme", "children", "appearance", "onClick", "onKeyPress", "onKeyDown", "isSelectable", "tabIndex", "className", "rightView", "arrowKeysOverrides"]);
      var themedClassName = theme.getTableCellClassName(appearance);
      return _react["default"].createElement(_TableRowContext.TableRowConsumer, null, function (height) {
        return _react["default"].createElement(_layers.Pane, (0, _extends2["default"])({
          innerRef: _this2.onRef,
          height: height,
          className: (0, _classnames["default"])(themedClassName, className),
          tabIndex: isSelectable ? tabIndex : undefined,
          "data-isselectable": isSelectable,
          onClick: onClick,
          onKeyDown: _this2.handleKeyDown
        }, TableCell.styles, props), children, rightView ? rightView : null);
      });
    }
  }]);
  return TableCell;
}(_react.PureComponent);

TableCell.displayName = "TableCell";
(0, _defineProperty2["default"])(TableCell, "propTypes", _objectSpread({}, _layers.Pane.propTypes, {
  /*
   * Makes the TableCell focusable. Used by EditableCell.
   * Will add tabIndex={-1 || this.props.tabIndex}.
   */
  isSelectable: _propTypes["default"].bool,

  /**
   * The appearance of the table row. Default theme only support default.
   */
  appearance: _propTypes["default"].string.isRequired,

  /**
   * Optional node to be placed on the right side of the table cell.
   * Useful for icons and icon buttons.
   */
  rightView: _propTypes["default"].node,

  /**
   * Theme provided by ThemeProvider.
   */
  theme: _propTypes["default"].object.isRequired,

  /**
   * Advanced arrow keys overrides for selectable cells.
   * A string will be used as a selector.
   */
  arrowKeysOverrides: _propTypes["default"].shape({
    up: _propTypes["default"].oneOfType([_propTypes["default"].string, _propTypes["default"].func, _propTypes["default"].element, _propTypes["default"].oneOf([false])]),
    down: _propTypes["default"].oneOfType([_propTypes["default"].string, _propTypes["default"].func, _propTypes["default"].element, _propTypes["default"].oneOf([false])]),
    left: _propTypes["default"].oneOfType([_propTypes["default"].string, _propTypes["default"].func, _propTypes["default"].element, _propTypes["default"].oneOf([false])]),
    right: _propTypes["default"].oneOfType([_propTypes["default"].string, _propTypes["default"].func, _propTypes["default"].element, _propTypes["default"].oneOf([false])])
  }),

  /**
   * Class name passed to the table cell.
   * Only use if you know what you are doing.
   */
  className: _propTypes["default"].string
}));
(0, _defineProperty2["default"])(TableCell, "defaultProps", {
  appearance: 'default'
});
(0, _defineProperty2["default"])(TableCell, "styles", {
  paddingX: 12,
  boxSizing: 'border-box',
  flex: 1,
  display: 'flex',
  alignItems: 'center',
  flexShrink: 0,
  overflow: 'hidden'
});

var _default = (0, _theme.withTheme)(TableCell);

exports["default"] = _default;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy90YWJsZS9zcmMvVGFibGVDZWxsLmpzIl0sIm5hbWVzIjpbImV4ZWN1dGVBcnJvd0tleU92ZXJyaWRlIiwib3ZlcnJpZGUiLCJkb2N1bWVudCIsInF1ZXJ5U2VsZWN0b3IiLCJmb2N1cyIsIlRhYmxlQ2VsbCIsImUiLCJwcm9wcyIsImFycm93S2V5c092ZXJyaWRlcyIsImlzU2VsZWN0YWJsZSIsImtleSIsInByZXZlbnREZWZhdWx0Iiwic2xpY2UiLCJsZW5ndGgiLCJ0b0xvd2VyQ2FzZSIsIm1haW5SZWYiLCJlcnJvciIsInRvYXN0ZXIiLCJkYW5nZXIiLCJjb25zb2xlIiwiYmx1ciIsIm9uS2V5RG93biIsInJlZiIsImlubmVyUmVmIiwidGhlbWUiLCJjaGlsZHJlbiIsImFwcGVhcmFuY2UiLCJvbkNsaWNrIiwib25LZXlQcmVzcyIsInRhYkluZGV4IiwiY2xhc3NOYW1lIiwicmlnaHRWaWV3IiwidGhlbWVkQ2xhc3NOYW1lIiwiZ2V0VGFibGVDZWxsQ2xhc3NOYW1lIiwiaGVpZ2h0Iiwib25SZWYiLCJ1bmRlZmluZWQiLCJoYW5kbGVLZXlEb3duIiwic3R5bGVzIiwiUHVyZUNvbXBvbmVudCIsIlBhbmUiLCJwcm9wVHlwZXMiLCJQcm9wVHlwZXMiLCJib29sIiwic3RyaW5nIiwiaXNSZXF1aXJlZCIsIm5vZGUiLCJvYmplY3QiLCJzaGFwZSIsInVwIiwib25lT2ZUeXBlIiwiZnVuYyIsImVsZW1lbnQiLCJvbmVPZiIsImRvd24iLCJsZWZ0IiwicmlnaHQiLCJwYWRkaW5nWCIsImJveFNpemluZyIsImZsZXgiLCJkaXNwbGF5IiwiYWxpZ25JdGVtcyIsImZsZXhTaHJpbmsiLCJvdmVyZmxvdyJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFBQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7Ozs7O0FBRUEsU0FBU0EsdUJBQVQsQ0FBaUNDLFFBQWpDLEVB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QkFBVVEsU0FBVixDQUFvQixDQUN4QlIsc0JBQVVFLE1BRGMsRUFFeEJGLHNCQUFVUyxJQUZjLEVBR3hCVCxzQkFBVVUsT0FIYyxFQUl4QlYsc0JBQVVXLEtBQVYsQ0FBZ0IsQ0FBQyxLQUFELENBQWhCLENBSndCLENBQXBCLENBYjRCO0FBbUJsQ0csSUFBQUEsS0FBSyxFQUFFZCxzQkFBVVEsU0FBVixDQUFvQixDQUN6QlIsc0JBQVVFLE1BRGUsRUFFekJGLHNCQUFVUyxJQUZlLEVBR3pCVCxzQkFBVVUsT0FIZSxFQUl6QlYsc0JBQVVXLEtBQVYsQ0FBZ0IsQ0FBQyxLQUFELENBQWhCLENBSnlCLENBQXBCO0FBbkIyQixHQUFoQixDOztBQTJCcEI7Ozs7QUFJQXZCLEVBQUFBLFNBQVMsRUFBRVksc0JBQVVFOztpQ0FoRW5CdkMsUyxrQkFtRWtCO0FBQ3BCcUIsRUFBQUEsVUFBVSxFQUFFO0FBRFEsQztpQ0FuRWxCckIsUyxZQXVFWTtBQUNkb0QsRUFBQUEsUUFBUSxFQUFFLEVBREk7QUFFZEMsRUFBQUEsU0FBUyxFQUFFLFlBRkc7QUFHZEMsRUFBQUEsSUFBSSxFQUFFLENBSFE7QUFJZEMsRUFBQUEsT0FBTyxFQUFFLE1BSks7QUFLZEMsRUFBQUEsVUFBVSxFQUFFLFFBTEU7QUFNZEMsRUFBQUEsVUFBVSxFQUFFLENBTkU7QUFPZEMsRUFBQUEsUUFBUSxFQUFFO0FBUEksQzs7ZUEyRkgsc0JBQVUxRCxTQUFWLEMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgUmVhY3QsIHsgUHVyZUNvbXBvbmVudCB9IGZyb20gJ3JlYWN0J1xuaW1wb3J0IFByb3BUeXBlcyBmcm9tICdwcm9wLXR5cGVzJ1xuaW1wb3J0IGN4IGZyb20gJ2NsYXNzbmFtZXMnXG5pbXBvcnQgeyB0b2FzdGVyIH0gZnJvbSAnLi4vLi4vdG9hc3RlcidcbmltcG9ydCB7IHdpdGhUaGVtZSB9IGZyb20gJy4uLy4uL3RoZW1lJ1xuaW1wb3J0IHsgUGFuZSB9IGZyb20gJy4uLy4uL2xheWVycydcbmltcG9ydCBzYWZlSW52b2tlIGZyb20gJy4uLy4uL2xpYi9zYWZlLWludm9rZSdcbmltcG9ydCB7IFRhYmxlUm93Q29uc3VtZXIgfSBmcm9tICcuL1RhYmxlUm93Q29udGV4dCdcbmltcG9ydCBtYW5hZ2VUYWJsZUNlbGxGb2N1c0ludGVyYWN0aW9uIGZyb20gJy4vbWFuYWdlVGFibGVDZWxsRm9jdXNJbnRlcmFjdGlvbidcblxuZnVuY3Rpb24gZXhlY3V0ZUFycm93S2V5T3ZlcnJpZGUob3ZlcnJpZGUpIHtcbiAgaWYgKCFvdmVycmlkZSkge1xuICAgIHJldHVyblxuICB9XG5cbiAgaWYgKHR5cGVvZiBvdmVycmlkZSA9PT0gJ2Z1bmN0aW9uJykge1xuICAgIG92ZXJyaWRlKClcbiAgICByZXR1cm5cbiAgfVxuXG4gIGlmICh0eXBlb2Ygb3ZlcnJpZGUgPT09ICdzdHJpbmcnKSB7XG4gICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvcihvdmVycmlkZSkuZm9jdXMoKVxuICAgIHJldHVyblxuICB9XG5cbiAgLy8gVGhpcyBuZWVkcyB0byBiZSB0aGUgbm9kZSwgbm90IGEgUmVhY3QgcmVmLlxuICBvdmVycmlkZS5mb2N1cygpXG59XG5cbmNsYXNzIFRhYmxlQ2VsbCBleHRlbmRzIFB1cmVDb21wb25lbnQge1xuICBzdGF0aWMgcHJvcFR5cGVzID0ge1xuICAgIC8qKlxuICAgICAqIENvbXBvc2VzIHRoZSBQYW5lIGNvbXBvbmVudCBhcyB0aGUgYmFzZS5cbiAgICAgKi9cbiAgICAuLi5QYW5lLnByb3BUeXBlcyxcblxuICAgIC8qXG4gICAgICogTWFrZXMgdGhlIFRhYmxlQ2VsbCBmb2N1c2FibGUuIFVzZWQgYnkgRWRpdGFibGVDZWxsLlxuICAgICAqIFdpbGwgYWRkIHRhYkluZGV4PXstMSB8fCB0aGlzLnByb3BzLnRhYkluZGV4fS5cbiAgICAgKi9cbiAgICBpc1NlbGVjdGFibGU6IFByb3BUeXBlcy5ib29sLFxuXG4gICAgLyoqXG4gICAgICogVGhlIGFwcGVhcmFuY2Ugb2YgdGhlIHRhYmxlIHJvdy4gRGVmYXVsdCB0aGVtZSBvbmx5IHN1cHBvcnQgZGVmYXVsdC5cbiAgICAgKi9cbiAgICBhcHBlYXJhbmNlOiBQcm9wVHlwZXMuc3RyaW5nLmlzUmVxdWlyZWQsXG5cbiAgICAvKipcbiAgICAgKiBPcHRpb25hbCBub2RlIHRvIGJlIHBsYWNlZCBvbiB0aGUgcmlnaHQgc2lkZSBvZiB0aGUgdGFibGUgY2VsbC5cbiAgICAgKiBVc2VmdWwgZm9yIGljb25zIGFuZCBpY29uIGJ1dHRvbnMuXG4gICAgICovXG4gICAgcmlnaHRWaWV3OiBQcm9wVHlwZXMubm9kZSxcblxuICAgIC8qKlxuICAgICAqIFRoZW1lIHByb3ZpZGVkIGJ5IFRoZW1lUHJvdmlkZXIuXG4gICAgICovXG4gICAgdGhlbWU6IFByb3BUeXBlcy5vYmplY3QuaXNSZXF1aXJlZCxcblxuICAgIC8qKlxuICAgICAqIEFkdmFuY2VkIGFycm93IGtleXMgb3ZlcnJpZGVzIGZvciBzZWxlY3RhYmxlIGNlbGxzLlxuICAgICAqIEEgc3RyaW5nIHdpbGwgYmUgdXNlZCBhcyBhIHNlbGVjdG9yLlxuICAgICAqL1xuICAgIGFycm93S2V5c092ZXJyaWRlczogUHJvcFR5cGVzLnNoYXBlKHtcbiAgICAgIHVwOiBQcm9wVHlwZXMub25lT2ZUeXBlKFtcbiAgICAgICAgUHJvcFR5cGVzLnN0cmluZyxcbiAgICAgICAgUHJvcFR5cGVzLmZ1bmMsXG4gICAgICAgIFByb3BUeXBlcy5lbGVtZW50LFxuICAgICAgICBQcm9wVHlwZXMub25lT2YoW2ZhbHNlXSlcbiAgICAgIF0pLFxuICAgICAgZG93bjogUHJvcFR5cGVzLm9uZU9mVHlwZShbXG4gICAgICAgIFByb3BUeXBlcy5zdHJpbmcsXG4gICAgICAgIFByb3BUeXBlcy5mdW5jLFxuICAgICAgICBQcm9wVHlwZXMuZWxlbWVudCxcbiAgICAgICAgUHJvcFR5cGVzLm9uZU9mKFtmYWxzZV0pXG4gICAgICBdKSxcbiAgICAgIGxlZnQ6IFByb3BUeXBlcy5vbmVPZlR5cGUoW1xuICAgICAgICBQcm9wVHlwZXMuc3RyaW5nLFxuICAgICAgICBQcm9wVHlwZXMuZnVuYyxcbiAgICAgICAgUHJvcFR5cGVzLmVsZW1lbnQsXG4gICAgICAgIFByb3BUeXBlcy5vbmVPZihbZmFsc2VdKVxuICAgICAgXSksXG4gICAgICByaWdodDogUHJvcFR5cGVzLm9uZU9mVHlwZShbXG4gICAgICAgIFByb3BUeXBlcy5zdHJpbmcsXG4gICAgICAgIFByb3BUeXBlcy5mdW5jLFxuICAgICAgICBQcm9wVHlwZXMuZWxlbWVudCxcbiAgICAgICAgUHJvcFR5cGVzLm9uZU9mKFtmYWxzZV0pXG4gICAgICBdKVxuICAgIH0pLFxuXG4gICAgLyoqXG4gICAgICogQ2xhc3MgbmFtZSBwYXNzZWQgdG8gdGhlIHRhYmxlIGNlbGwuXG4gICAgICogT25seSB1c2UgaWYgeW91IGtub3cgd2hhdCB5b3UgYXJlIGRvaW5nLlxuICAgICAqL1xuICAgIGNsYXNzTmFtZTogUHJvcFR5cGVzLnN0cmluZ1xuICB9XG5cbiAgc3RhdGljIGRlZmF1bHRQcm9wcyA9IHtcbiAgICBhcHBlYXJhbmNlOiAnZGVmYXVsdCdcbiAgfVxuXG4gIHN0YXRpYyBzdHlsZXMgPSB7XG4gICAgcGFkZGluZ1g6IDEyLFxuICAgIGJveFNpemluZzogJ2JvcmRlci1ib3gnLFxuICAgIGZsZXg6IDEsXG4gICAgZGlzcGxheTogJ2ZsZXgnLFxuICAgIGFsaWduSXRlbXM6ICdjZW50ZXInLFxuICAgIGZsZXhTaHJpbms6IDAsXG4gICAgb3ZlcmZsb3c6ICdoaWRkZW4nXG4gIH1cblxuICBoYW5kbGVLZXlEb3duID0gZSA9PiB7XG4gICAgY29uc3QgeyBhcnJvd0tleXNPdmVycmlkZXMgPSB7fSB9ID0gdGhpcy5wcm9wc1xuXG4gICAgaWYgKHRoaXMucHJvcHMuaXNTZWxlY3RhYmxlKSB7XG4gICAgICBjb25zdCB7IGtleSB9ID0gZVxuICAgICAgaWYgKFxuICAgICAgICBrZXkgPT09ICdBcnJvd1VwJyB8fFxuICAgICAgICBrZXkgPT09ICdBcnJvd0Rvd24nIHx8XG4gICAgICAgIGtleSA9PT0gJ0Fycm93TGVmdCcgfHxcbiAgICAgICAga2V5ID09PSAnQXJyb3dSaWdodCdcbiAgICAgICkge1xuICAgICAgICBlLnByZXZlbnREZWZhdWx0KClcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAvLyBTdXBwb3J0IGFycm93IGtleSBvdmVycmlkZXMuXG4gICAgICAgICAgY29uc3Qgb3ZlcnJpZGUgPVxuICAgICAgICAgICAgYXJyb3dLZXlzT3ZlcnJpZGVzW2tleS5zbGljZSgnQXJyb3cnLmxlbmd0aCkudG9Mb3dlckNhc2UoKV1cbiAgICAgICAgICBpZiAob3ZlcnJpZGUgPT09IGZhbHNlKSByZXR1cm5cbiAgICAgICAgICBpZiAob3ZlcnJpZGUpIHJldHVybiBleGVjdXRlQXJyb3dLZXlPdmVycmlkZShvdmVycmlkZSlcblxuICAgICAgICAgIG1hbmFnZVRhYmxlQ2VsbEZvY3VzSW50ZXJhY3Rpb24oa2V5LCB0aGlzLm1haW5SZWYpXG4gICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgICAgdG9hc3Rlci5kYW5nZXIoJ0tleWJvYXJkIGludGVyYWN0aW9uIG5vdCBwb3NzaWJsZScpXG4gICAgICAgICAgY29uc29sZS5lcnJvcignS2V5Ym9hcmQgaW50ZXJhY3Rpb24gbm90IHBvc3NpYmxlJywgZXJyb3IpXG4gICAgICAgIH1cbiAgICAgIH0gZWxzZSBpZiAoa2V5ID09PSAnRXNjYXBlJykge1xuICAgICAgICB0aGlzLm1haW5SZWYuYmx1cigpXG4gICAgICB9XG4gICAgfVxuXG4gICAgc2FmZUludm9rZSh0aGlzLnByb3BzLm9uS2V5RG93biwgZSlcbiAgfVxuXG4gIG9uUmVmID0gcmVmID0+IHtcbiAgICB0aGlzLm1haW5SZWYgPSByZWZcbiAgICBzYWZlSW52b2tlKHRoaXMucHJvcHMuaW5uZXJSZWYsIHJlZilcbiAgfVxuXG4gIHJlbmRlcigpIHtcbiAgICBjb25zdCB7XG4gICAgICBpbm5lclJlZixcbiAgICAgIHRoZW1lLFxuICAgICAgY2hpbGRyZW4sXG4gICAgICBhcHBlYXJhbmNlLFxuICAgICAgb25DbGljayxcbiAgICAgIG9uS2V5UHJlc3MsXG4gICAgICBvbktleURvd24sXG4gICAgICBpc1NlbGVjdGFibGUsXG4gICAgICB0YWJJbmRleCA9IC0xLFxuICAgICAgY2xhc3NOYW1lLFxuICAgICAgcmlnaHRWaWV3LFxuICAgICAgYXJyb3dLZXlzT3ZlcnJpZGVzLFxuICAgICAgLi4ucHJvcHNcbiAgICB9ID0gdGhpcy5wcm9wc1xuXG4gICAgY29uc3QgdGhlbWVkQ2xhc3NOYW1lID0gdGhlbWUuZ2V0VGFibGVDZWxsQ2xhc3NOYW1lKGFwcGVhcmFuY2UpXG5cbiAgICByZXR1cm4gKFxuICAgICAgPFRhYmxlUm93Q29uc3VtZXI+XG4gICAgICAgIHtoZWlnaHQgPT4ge1xuICAgICAgICAgIHJldHVybiAoXG4gICAgICAgICAgICA8UGFuZVxuICAgICAgICAgICAgICBpbm5lclJlZj17dGhpcy5vblJlZn1cbiAgICAgICAgICAgICAgaGVpZ2h0PXtoZWlnaHR9XG4gICAgICAgICAgICAgIGNsYXNzTmFtZT17Y3godGhlbWVkQ2xhc3NOYW1lLCBjbGFzc05hbWUpfVxuICAgICAgICAgICAgICB0YWJJbmRleD17aXNTZWxlY3RhYmxlID8gdGFiSW5kZXggOiB1bmRlZmluZWR9XG4gICAgICAgICAgICAgIGRhdGEtaXNzZWxlY3RhYmxlPXtpc1NlbGVjdGFibGV9XG4gICAgICAgICAgICAgIG9uQ2xpY2s9e29uQ2xpY2t9XG4gICAgICAgICAgICAgIG9uS2V5RG93bj17dGhpcy5oYW5kbGVLZXlEb3dufVxuICAgICAgICAgICAgICB7Li4uVGFibGVDZWxsLnN0eWxlc31cbiAgICAgICAgICAgICAgey4uLnByb3BzfVxuICAgICAgICAgICAgPlxuICAgICAgICAgICAgICB7Y2hpbGRyZW59XG4gICAgICAgICAgICAgIHtyaWdodFZpZXcgPyByaWdodFZpZXcgOiBudWxsfVxuICAgICAgICAgICAgPC9QYW5lPlxuICAgICAgICAgIClcbiAgICAgICAgfX1cbiAgICAgIDwvVGFibGVSb3dDb25zdW1lcj5cbiAgICApXG4gIH1cbn1cblxuZXhwb3J0IGRlZmF1bHQgd2l0aFRoZW1lKFRhYmxlQ2VsbClcbiJdfQ==